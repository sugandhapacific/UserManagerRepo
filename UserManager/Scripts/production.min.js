function row(a){this.cells=a}var mainSections=function(){function a(){this.table=document.getElementById("displayUserList"),this.userForm=document.getElementById("addUser"),this.options=document.getElementById("options"),this.errorPara=document.getElementsByClassName("errorPara"),this.addUsrBtn=document.querySelector('#mainOptions > input[value="Add User"]'),this.showUsrBtn=document.querySelector('#mainOptions > input[value="User List"]'),this.nav=document.getElementById("mainOptions"),this.welcome=document.getElementById("welcomeDiv"),this.home=document.querySelector('#mainOptions > input[value="Home"]')}return a.prototype.hideAll=function(){this.toggleDisplay("none","none","none","block","none","none","none"),this.hideError()},a.prototype.hideError=function(){var a;for(a=0;a<this.errorPara.length;a++)this.errorPara[a].style.display="none"},a.prototype.toggleDisplay=function(a,b,c,d,e,f,g){this.userForm.style.display=a,this.options.style.display=b,this.nav.style.display=c,this.welcome.style.display=d,this.table.style.display=e,this.showUsrBtn.style.display=g,this.addUsrBtn.style.display=f},a}(),userElements=function(){function a(){this.userId=document.getElementById("userId"),this.firstName=document.getElementById("fName"),this.lastName=document.getElementById("lName"),this.email=document.getElementById("email"),this.phone=document.getElementById("phone")}return a.prototype.getUser=function(){document.documentElement.style.cursor="progress",document.querySelector('#welcomeDiv > input[value="User List"]').style.cursor="progress",document.body.appendChild(sections.options),ajax.send("/User",null,"GET",function(a){var b=JSON.parse(a),c=document.getElementById("Handlebars-Template").textContent,d=Handlebars.compile(c),e=d({Users:b});sections.table.innerHTML=e;for(var f=document.getElementById("UserData").getElementsByTagName("tr"),g=1;g<f.length;g++){var h=f[g].getElementsByTagName("td")[5];h.firstChild.innerHTML.indexOf("Inactive")>-1&&h.parentNode.classList.add("disabled")}sections.toggleDisplay("none","none","block","none","block","block","none"),document.documentElement.style.cursor="default",document.querySelector('#welcomeDiv > input[value="User List"]').style.cursor="default"})},a.prototype.addUser=function(){var a="firstName="+this.firstName.value+"&lastName="+this.lastName.value+"&email="+this.email.value+"&phone="+this.phone.value;ajax.send("/User",a,"POST",function(a){if(a){var b=user.resetUser.bind(user);b(),alert("User Added"),b=user.getUser.bind(user),b()}})},a.prototype.updateUser=function(){sections.toggleDisplay("block","none","block","none","none","none","block"),selectedRow&&(this.userId.value=selectedRow.cells[0].innerHTML,this.firstName.value=selectedRow.cells[1].firstChild.innerHTML,this.lastName.value=selectedRow.cells[2].firstChild.innerHTML,this.email.value=selectedRow.cells[3].firstChild.innerHTML,this.phone.value=selectedRow.cells[4].firstChild.innerHTML)},a.prototype.updateSubmit=function(a){if(document.body.appendChild(sections.options),a&&selectedRow)var b="UserId="+selectedRow.cells[0].innerHTML+"&firstName="+selectedRow.cells[1].firstChild.innerHTML+"&lastName="+selectedRow.cells[2].firstChild.innerHTML+"&email="+selectedRow.cells[3].firstChild.innerHTML+"&phone="+selectedRow.cells[4].firstChild.innerHTML+"&status="+selectedRow.cells[5].firstChild.innerHTML;else var b="UserId="+this.userId.value+"&firstName="+this.firstName.value+"&lastName="+this.lastName.value+"&email="+this.email.value+"&phone="+this.phone.value+"&status=Active";ajax.send("/User",b,"PUT",function(b){if(b){if(!a){var c=user.resetUser.bind(user);c(),alert("User Updated")}c=user.getUser.bind(user),c()}})},a.prototype.deleteUser=function(){var a="UserId="+selectedRow.cells[0].innerHTML;ajax.send("/User",a,"DELETE",function(a){a&&(row&&(document.body.appendChild(sections.options),document.getElementById("UserData").deleteRow(selectedRow.cells[0].parentNode.rowIndex)),sections.toggleDisplay("none","none","block","none","block","block","none"),alert("User Deleted"))})},a.prototype.deactivate=function(){selectedRow.cells[0].parentNode.classList.add("disabled"),selectedRow.cells[5].firstChild.innerHTML="Inactive",this.updateSubmit(!0)},a.prototype.sort=function(){for(var a=document.getElementsByTagName("thead")[0].getElementsByTagName("th")[1],b=document.getElementById("UserData").getElementsByTagName("tbody")[0],c=b.getElementsByTagName("tr"),d=0;d<c.length-1;d++)for(var e=d+1;e<c.length;e++)c[d].cells[1].firstChild.innerHTML.toLowerCase()>c[e].cells[1].firstChild.innerHTML.toLowerCase()&&a.getElementsByTagName("span")[0].innerHTML.indexOf("  ▲")<0?b.insertBefore(c[e],c[d]):c[d].cells[1].firstChild.innerHTML.toLowerCase()<c[e].cells[1].firstChild.innerHTML.toLowerCase()&&a.getElementsByTagName("span")[0].innerHTML.indexOf("  ▲")>-1&&b.insertBefore(c[e],c[d]);a.getElementsByTagName("span")[0].innerHTML.indexOf("  ▲")<0?a.getElementsByTagName("span")[0].innerHTML="  &#9650;":a.getElementsByTagName("span")[0].innerHTML="  &#9660;"},a.prototype.resetUser=function(){this.userId.value=null,this.firstName.value=null,this.lastName.value=null,this.email.value=null,this.phone.value=null,sections.toggleDisplay("block","none","block","none","none","none","block")},a.prototype.formValidation=function(){sections.hideError();var a=!1;this.firstName.value.match(/^[A-Za-z]+$/)||(this.firstName.nextElementSibling.style.display="inline",a=!0),""==this.lastName.value||this.lastName.value.match(/^[A-Za-z]+$/)||(this.lastName.nextElementSibling.style.display="inline",a=!0),""!=this.email.value&&(2!=this.email.value.split("@").length||this.email.value.split(".").length<=1)&&(this.email.nextElementSibling.style.display="inline",a=!0),""==this.phone.value||this.phone.value.match(/^[0-9]{10}$/)||(this.phone.nextElementSibling.style.display="inline",a=!0),a||(""==this.userId.value?this.addUser():this.updateSubmit(!1))},a}(),ajaxWrapper=function(){function a(){}return a.prototype.send=function(a,b,c,d){var e=new XMLHttpRequest;if(void 0!==a){var f=a.indexOf("?")>0?"&":"?";a+=f+"random="+(new Date).getTime()}e.open(c,a,!0),e.onreadystatechange=function(){4==e.readyState&&200==e.status&&d(e.responseText)},("POST"==c||"PUT"==c||"DELETE"==c)&&e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.send(b)},a}(),selectedRow={},sections=new mainSections,user=new userElements,ajax=new ajaxWrapper;window.addEventListener("load",function(){sections.hideAll(),sections.options.addEventListener("click",function(a){a=a||window.event;var b=a.srcElement||a.target;if("LI"==b.nodeName){switch(b.innerHTML){case"Edit":user.updateUser();break;case"Delete":1==confirm("Press OK to delete user : "+selectedRow.cells[1].firstChild.innerHTML+" permanently")&&user.deleteUser();break;case"Sort":user.sort();break;case"Deactivate":user.deactivate()}sections.options.style.display="none"}}),sections.table.addEventListener("contextmenu",function(a){a.preventDefault(),a=a||window.event;var b=a.srcElement||a.target;if("SPAN"==b.nodeName||"TD"==b.nodeName){b="SPAN"==b.nodeName?b.parentNode:b,b.appendChild(sections.options);for(var c=b;c&&"TR"!==c.nodeName;)c=c.parentNode;selectedRow=new row(c.getElementsByTagName("td")),c.className.indexOf("disabled")<0?sections.options.style.display="block":sections.options.style.display="none"}}),sections.table.addEventListener("click",function(){sections.options.style.display="none"})});